<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS ‚Ä¢ –í–°–Å –í –û–î–ù–û–ú</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #0a0f1f;
            color: white;
            padding: 16px;
            max-width: 500px;
            margin: 0 auto;
        }
        .nav-tabs {
            display: flex;
            gap: 8px;
            background: #121826;
            padding: 6px;
            border-radius: 100px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .nav-tab {
            padding: 10px 16px;
            border-radius: 100px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: 0.2s;
            color: #a0b0c0;
            white-space: nowrap;
        }
        .nav-tab.active {
            background: #2e7eff;
            color: white;
        }
        .nav-tab:hover {
            background: #3a4a6a;
            color: white;
        }
        .card {
            background: #1a1f30;
            border-radius: 24px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid #2e3a4a;
        }
        h2 {
            font-size: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tariff-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #121826;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 10px;
            border: 1px solid #2a3344;
        }
        .tariff-info h3 {
            font-size: 18px;
            margin-bottom: 4px;
        }
        .tariff-info p {
            font-size: 14px;
            color: #a0b0c0;
        }
        .tariff-price {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            margin-right: 12px;
        }
        .buy-btn {
            background: #2e7eff;
            color: white;
            border: none;
            border-radius: 40px;
            padding: 8px 16px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        .buy-btn:hover {
            background: #1a5bbf;
        }
        .slider-item {
            margin: 20px 0;
        }
        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        input[type=range] {
            width: 100%;
            height: 6px;
            background: #2a3344;
            border-radius: 10px;
            -webkit-appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            border: 2px solid #2e7eff;
            cursor: pointer;
        }
        .total {
            background: linear-gradient(135deg, #2e7eff, #9d4eff);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }
        .total-amount {
            font-size: 32px;
            font-weight: bold;
        }
        .btn {
            background: #2e7eff;
            color: white;
            border: none;
            border-radius: 16px;
            padding: 14px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            margin-top: 12px;
            transition: 0.2s;
        }
        .btn.secondary {
            background: #333a4a;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .input-field, select {
            width: 100%;
            padding: 14px;
            background: #121826;
            border: 1px solid #2a3344;
            border-radius: 16px;
            color: white;
            margin-bottom: 12px;
            font-size: 16px;
        }
        .input-field:focus, select:focus {
            outline: none;
            border-color: #2e7eff;
        }
        .result-box {
            background: #121826;
            border-radius: 16px;
            padding: 16px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
            border: 1px solid #2a3344;
            display: none;
        }
        .result-item {
            padding: 8px;
            border-bottom: 1px solid #2a3344;
        }
        .footer {
            text-align: center;
            color: #6a7a8a;
            font-size: 12px;
            margin-top: 30px;
        }
        .feature-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #2a3344;
        }
        .toggle-switch {
            width: 44px;
            height: 24px;
            background: #2a3344;
            border-radius: 100px;
            position: relative;
            cursor: pointer;
        }
        .toggle-switch.active {
            background: #2e7eff;
        }
        .toggle-switch::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: 0.2s;
        }
        .toggle-switch.active::before {
            left: 22px;
        }
        .badge {
            background: #2e7eff;
            padding: 2px 8px;
            border-radius: 100px;
            font-size: 10px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
    <div class="nav-tabs">
        <div class="nav-tab active" data-tab="tariffs">üí∞ –¢–∞—Ä–∏—Ñ—ã</div>
        <div class="nav-tab" data-tab="parse">üîç –ü–∞—Ä—Å–∏–Ω–≥</div>
        <div class="nav-tab" data-tab="invite">üì® –ò–Ω–≤–∞–π—Ç–∏–Ω–≥</div>
        <div class="nav-tab" data-tab="warmup">üî• –ü—Ä–æ–≥—Ä–µ–≤</div>
        <div class="nav-tab" data-tab="stats">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div class="nav-tab" data-tab="profile">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>

    <!-- ========== –í–ö–õ–ê–î–ö–ê –¢–ê–†–ò–§–´ ========== -->
    <div id="tab-tariffs" class="tab-content active">
        <div class="card">
            <h2>üí∞ –ì–û–¢–û–í–´–ï –¢–ê–†–ò–§–´</h2>
            <div class="tariff-item">
                <div class="tariff-info">
                    <h3>üî• –°—É—Ç–∫–∏</h3>
                    <p>2 –ø–æ—Ç–æ–∫–∞ ¬∑ 24 —á–∞—Å–∞ ¬∑ –±–∞–∑–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥</p>
                </div>
                <div style="display: flex; align-items: center;">
                    <span class="tariff-price">5‚≠ê</span>
                    <button class="buy-btn" data-tariff="day">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <div class="tariff-item" style="border-color: #2e7eff;">
                <div class="tariff-info">
                    <h3>‚ö° –ú–µ—Å—è—Ü <span class="badge">–•–ò–¢</span></h3>
                    <p>3 –ø–æ—Ç–æ–∫–∞ ¬∑ 30 –¥–Ω–µ–π ¬∑ –ø–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª</p>
                </div>
                <div style="display: flex; align-items: center;">
                    <span class="tariff-price">15‚≠ê</span>
                    <button class="buy-btn" data-tariff="month">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <div class="tariff-item">
                <div class="tariff-info">
                    <h3>üí™ –ü–æ–ª–≥–æ–¥–∞</h3>
                    <p>7 –ø–æ—Ç–æ–∫–æ–≤ ¬∑ 180 –¥–Ω–µ–π ¬∑ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</p>
                </div>
                <div style="display: flex; align-items: center;">
                    <span class="tariff-price">45‚≠ê</span>
                    <button class="buy-btn" data-tariff="halfyear">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
            <div class="tariff-item">
                <div class="tariff-info">
                    <h3>üëë –ì–æ–¥</h3>
                    <p>15 –ø–æ—Ç–æ–∫–æ–≤ ¬∑ 365 –¥–Ω–µ–π ¬∑ VIP</p>
                </div>
                <div style="display: flex; align-items: center;">
                    <span class="tariff-price">85‚≠ê</span>
                    <button class="buy-btn" data-tariff="year">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>‚öôÔ∏è –ö–û–ù–°–¢–†–£–ö–¢–û–† –¢–ê–†–ò–§–ê</h2>
            <!-- –ü–æ—Ç–æ–∫–∏ -->
            <div class="slider-item">
                <div class="slider-header">
                    <span>üìä –ü–æ—Ç–æ–∫–∏</span>
                    <span id="threadsVal">5</span>
                </div>
                <input type="range" id="threads" min="1" max="20" value="5">
            </div>
            <!-- –î–Ω–∏ -->
            <div class="slider-item">
                <div class="slider-header">
                    <span>‚è±Ô∏è –î–Ω–∏</span>
                    <span id="daysVal">30</span>
                </div>
                <input type="range" id="days" min="1" max="365" value="30">
            </div>
            <!-- –°–∫–æ—Ä–æ—Å—Ç—å –∏–Ω–≤–∞–π—Ç–∏–Ω–≥–∞ (—Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω) -->
            <div class="slider-item">
                <div class="slider-header">
                    <span>üì® –°–∫–æ—Ä–æ—Å—Ç—å –∏–Ω–≤–∞–π—Ç–∏–Ω–≥–∞</span>
                    <span id="inviteSpeedVal">10/–º–∏–Ω</span>
                </div>
                <input type="range" id="inviteSpeed" min="5" max="60" value="10">
            </div>
            <!-- –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –ø—Ä–æ–≥—Ä–µ–≤–∞ (—Å–µ–∫) -->
            <div class="slider-item">
                <div class="slider-header">
                    <span>‚è∏Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–≥—Ä–µ–≤–∞</span>
                    <span id="warmupDelayVal">5 —Å–µ–∫</span>
                </div>
                <input type="range" id="warmupDelay" min="2" max="30" value="5">
            </div>
            <!-- –î–æ–ø. —Ñ—É–Ω–∫—Ü–∏–∏ (—Ç–æ–≥–≥–ª—ã) -->
            <div class="feature-toggle">
                <span>üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (–±–∏–æ, –≥–µ–æ)</span>
                <div class="toggle-switch" id="toggleAdvancedParse"></div>
            </div>
            <div class="feature-toggle">
                <span>üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel + CSV</span>
                <div class="toggle-switch" id="toggleExport"></div>
            </div>
            <div class="feature-toggle">
                <span>ü§ñ –ê–≤—Ç–æ-–ø—Ä–æ–≥—Ä–µ–≤ (24/7)</span>
                <div class="toggle-switch" id="toggleAutoWarmup"></div>
            </div>

            <div class="total">
                <div>
                    <div>–ò–¢–û–ì–û</div>
                    <div style="font-size: 12px;">—Ü–µ–Ω–∞ –≤ –∑–≤—ë–∑–¥–∞—Ö</div>
                </div>
                <div class="total-amount" id="totalPrice">149‚≠ê</div>
            </div>
            <button class="btn" id="buyCustomBtn">üöÄ –ö–£–ü–ò–¢–¨ –ö–û–ù–°–¢–†–£–ö–¢–û–†</button>
        </div>
    </div>

    <!-- ========== –í–ö–õ–ê–î–ö–ê –ü–ê–†–°–ò–ù–ì ========== -->
    <div id="tab-parse" class="tab-content">
        <div class="card">
            <h2>üîç –ü–ê–†–°–ò–ù–ì</h2>
            <select id="parseType">
                <option value="members">üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞/–≥—Ä—É–ø–ø—ã</option>
                <option value="commentators">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ç–æ—Ä—ã –∫–∞–Ω–∞–ª–∞</option>
                <option value="search">üîé –ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º</option>
            </select>
            <div id="membersInput">
                <input type="text" class="input-field" id="chatLink" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, @channel)">
                <input type="number" class="input-field" id="memberLimit" placeholder="–õ–∏–º–∏—Ç (–º–∞–∫—Å 1000)" value="500">
            </div>
            <div id="commentatorsInput" style="display: none;">
                <input type="text" class="input-field" id="channelLink" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª (@channel)">
                <input type="number" class="input-field" id="postsLimit" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤" value="5">
            </div>
            <div id="searchInput" style="display: none;">
                <input type="text" class="input-field" id="keywords" placeholder="–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)">
                <input type="number" class="input-field" id="searchLimit" placeholder="–õ–∏–º–∏—Ç" value="50">
            </div>
            <button class="btn" id="startParseBtn">üöÄ –ù–ê–ß–ê–¢–¨ –ü–ê–†–°–ò–ù–ì</button>
            <div class="result-box" id="parseResult">
                <div style="display: flex; justify-content: space-between;">
                    <span>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã: <span id="parseCount">0</span></span>
                    <div>
                        <button class="btn secondary" style="padding: 4px 8px; width: auto;" id="exportCsvBtn">CSV</button>
                        <button class="btn secondary" style="padding: 4px 8px; width: auto;" id="exportExcelBtn">Excel</button>
                    </div>
                </div>
                <div id="parseList"></div>
            </div>
        </div>
    </div>

    <!-- ========== –í–ö–õ–ê–î–ö–ê –ò–ù–í–ê–ô–¢–ò–ù–ì ========== -->
    <div id="tab-invite" class="tab-content">
        <div class="card">
            <h2>üì® –ò–ù–í–ê–ô–¢–ò–ù–ì</h2>
            <input type="text" class="input-field" id="inviteChat" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è">
            <select id="inviteSource" class="input-field">
                <option value="file">üìÅ –ò–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞</option>
                <option value="parse">üìä –ò–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞</option>
            </select>
            <div id="inviteFileInput" style="display: block;">
                <input type="file" id="inviteFile" accept=".txt,.csv" style="display: none;">
                <button class="btn secondary" id="chooseFileBtn">üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª —Å —é–∑–µ—Ä–∞–º–∏</button>
                <span id="fileName"></span>
            </div>
            <div class="slider-item">
                <div class="slider-header">
                    <span>‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è–º–∏ (—Å–µ–∫)</span>
                    <span id="inviteDelayVal">5</span>
                </div>
                <input type="range" id="inviteDelay" min="2" max="60" value="5">
            </div>
            <button class="btn" id="startInviteBtn">üöÄ –ó–ê–ü–£–°–¢–ò–¢–¨ –ò–ù–í–ê–ô–¢–ò–ù–ì</button>
        </div>
    </div>

    <!-- ========== –í–ö–õ–ê–î–ö–ê –ü–†–û–ì–†–ï–í ========== -->
    <div id="tab-warmup" class="tab-content">
        <div class="card">
            <h2>üî• –ü–†–û–ì–†–ï–í –ê–ö–ö–ê–£–ù–¢–û–í</h2>
            <select id="warmupAccounts" class="input-field">
                <option value="all">üë• –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã</option>
                <option value="selected">üîò –í—ã–±—Ä–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ</option>
            </select>
            <div class="slider-item">
                <div class="slider-header">
                    <span>‚è±Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –¥–µ–π—Å—Ç–≤–∏—è–º–∏ (—Å–µ–∫)</span>
                    <span id="warmupDelayVal2">5</span>
                </div>
                <input type="range" id="warmupDelay2" min="2" max="30" value="5">
            </div>
            <div style="margin: 16px 0;">
                <label style="display: block; margin-bottom: 8px;">–¢–∏–ø—ã –¥–µ–π—Å—Ç–≤–∏–π:</label>
                <label><input type="checkbox" id="actionView" checked> üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–µ–π</label><br>
                <label><input type="checkbox" id="actionLike" checked> ‚ù§Ô∏è –õ–∞–π–∫–∏</label><br>
                <label><input type="checkbox" id="actionComment"> üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label><br>
                <label><input type="checkbox" id="actionJoin"> ‚ûï –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —á–∞—Ç—ã</label>
            </div>
            <button class="btn" id="startWarmupBtn">üî• –ó–ê–ü–£–°–¢–ò–¢–¨ –ü–†–û–ì–†–ï–í</button>
        </div>
    </div>

    <!-- ========== –í–ö–õ–ê–î–ö–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ê ========== -->
    <div id="tab-stats" class="tab-content">
        <div class="card">
            <h2>üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h2>
            <div id="statsContent">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <button class="btn secondary" id="refreshStatsBtn">üîÑ –û–ë–ù–û–í–ò–¢–¨</button>
        </div>
    </div>

    <!-- ========== –í–ö–õ–ê–î–ö–ê –ü–†–û–§–ò–õ–¨ ========== -->
    <div id="tab-profile" class="tab-content">
        <div class="card">
            <h2>üë§ –ü–†–û–§–ò–õ–¨</h2>
            <div id="profileContent">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <button class="btn secondary" id="refreshProfileBtn">üîÑ –û–ë–ù–û–í–ò–¢–¨</button>
        </div>
    </div>

    <div class="footer">
        NEXUS ‚Ä¢ –í–°–Å –í –û–î–ù–û–ú
    </div>

    <script>
        const tg = Telegram.WebApp;
        tg.expand();
        tg.ready();

        // ---------- –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö ----------
        const tabs = document.querySelectorAll('.nav-tab');
        const contents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const target = tab.dataset.tab;
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                contents.forEach(c => c.classList.remove('active'));
                document.getElementById(`tab-${target}`).classList.add('active');
            });
        });

        // ---------- –û–ë–©–ò–ï –î–ê–ù–ù–´–ï ----------
        let constructorState = {
            threads: 5,
            days: 30,
            inviteSpeed: 10,
            warmupDelay: 5,
            advancedParse: false,
            exportEnabled: false,
            autoWarmup: false
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
        const threadsInput = document.getElementById('threads');
        const daysInput = document.getElementById('days');
        const inviteSpeedInput = document.getElementById('inviteSpeed');
        const warmupDelayInput = document.getElementById('warmupDelay');
        const threadsVal = document.getElementById('threadsVal');
        const daysVal = document.getElementById('daysVal');
        const inviteSpeedVal = document.getElementById('inviteSpeedVal');
        const warmupDelayVal = document.getElementById('warmupDelayVal');
        const totalPriceSpan = document.getElementById('totalPrice');
        const toggleAdvanced = document.getElementById('toggleAdvancedParse');
        const toggleExport = document.getElementById('toggleExport');
        const toggleAuto = document.getElementById('toggleAutoWarmup');

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
        function updateConstructorPrice() {
            const threads = parseInt(threadsInput.value);
            const days = parseInt(daysInput.value);
            const inviteSpeed = parseInt(inviteSpeedInput.value);
            const warmupDelay = parseInt(warmupDelayInput.value);

            threadsVal.innerText = threads;
            daysVal.innerText = days;
            inviteSpeedVal.innerText = inviteSpeed + '/–º–∏–Ω';
            warmupDelayVal.innerText = warmupDelay + ' —Å–µ–∫';

            // –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Ä—É–±–ª—è—Ö
            let priceRub = (threads * 50) + (days * 15) + (inviteSpeed * 2) + (warmupDelay * 1);
            priceRub = Math.round(priceRub * 1.3);
            if (constructorState.advancedParse) priceRub += 200;
            if (constructorState.exportEnabled) priceRub += 150;
            if (constructorState.autoWarmup) priceRub += 300;
            if (priceRub < 199) priceRub = 199;

            const stars = Math.max(1, Math.round(priceRub / 7));
            totalPriceSpan.innerText = stars + '‚≠ê';
        }

        // –°–æ–±—ã—Ç–∏—è –Ω–∞ —Å–ª–∞–π–¥–µ—Ä—ã
        threadsInput.addEventListener('input', updateConstructorPrice);
        daysInput.addEventListener('input', updateConstructorPrice);
        inviteSpeedInput.addEventListener('input', updateConstructorPrice);
        warmupDelayInput.addEventListener('input', updateConstructorPrice);

        // –¢–æ–≥–≥–ª—ã
        toggleAdvanced.addEventListener('click', () => {
            toggleAdvanced.classList.toggle('active');
            constructorState.advancedParse = toggleAdvanced.classList.contains('active');
            updateConstructorPrice();
        });
        toggleExport.addEventListener('click', () => {
            toggleExport.classList.toggle('active');
            constructorState.exportEnabled = toggleExport.classList.contains('active');
            updateConstructorPrice();
        });
        toggleAuto.addEventListener('click', () => {
            toggleAuto.classList.toggle('active');
            constructorState.autoWarmup = toggleAuto.classList.contains('active');
            updateConstructorPrice();
        });

        // –ü–æ–∫—É–ø–∫–∞ –≥–æ—Ç–æ–≤–æ–≥–æ —Ç–∞—Ä–∏—Ñ–∞
        document.querySelectorAll('.buy-btn[data-tariff]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const tariff = e.target.dataset.tariff;
                tg.sendData(JSON.stringify({ action: 'buy_tariff', tariff }));
                tg.HapticFeedback.notificationOccurred('success');
                tg.close();
            });
        });

        // –ü–æ–∫—É–ø–∫–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
        document.getElementById('buyCustomBtn').addEventListener('click', () => {
            const threads = threadsInput.value;
            const days = daysInput.value;
            const inviteSpeed = inviteSpeedInput.value;
            const warmupDelay = warmupDelayInput.value;
            const advancedParse = constructorState.advancedParse;
            const exportEnabled = constructorState.exportEnabled;
            const autoWarmup = constructorState.autoWarmup;

            // –†–∞—Å—Å—á—ë—Ç —Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö (–¥–ª—è –±–æ—Ç–∞)
            let priceRub = (parseInt(threads) * 50 + parseInt(days) * 15 + parseInt(inviteSpeed) * 2 + parseInt(warmupDelay) * 1) * 1.3;
            if (advancedParse) priceRub += 200;
            if (exportEnabled) priceRub += 150;
            if (autoWarmup) priceRub += 300;
            priceRub = Math.round(priceRub);
            if (priceRub < 199) priceRub = 199;

            tg.sendData(JSON.stringify({
                action: 'buy_custom',
                threads,
                days,
                inviteSpeed,
                warmupDelay,
                advancedParse,
                exportEnabled,
                autoWarmup,
                price: priceRub + '‚ÇΩ'
            }));
            tg.HapticFeedback.notificationOccurred('success');
            tg.close();
        });

        // ---------- –ü–ê–†–°–ò–ù–ì ----------
        const parseType = document.getElementById('parseType');
        const membersDiv = document.getElementById('membersInput');
        const commentatorsDiv = document.getElementById('commentatorsInput');
        const searchDiv = document.getElementById('searchInput');

        parseType.addEventListener('change', () => {
            const val = parseType.value;
            membersDiv.style.display = val === 'members' ? 'block' : 'none';
            commentatorsDiv.style.display = val === 'commentators' ? 'block' : 'none';
            searchDiv.style.display = val === 'search' ? 'block' : 'none';
        });

        document.getElementById('startParseBtn').addEventListener('click', () => {
            const type = parseType.value;
            let data = { action: 'start_parsing', type };
            if (type === 'members') {
                data.chat_link = document.getElementById('chatLink').value;
                data.limit = document.getElementById('memberLimit').value;
            } else if (type === 'commentators') {
                data.channel_link = document.getElementById('channelLink').value;
                data.posts_limit = document.getElementById('postsLimit').value;
            } else if (type === 'search') {
                data.keywords = document.getElementById('keywords').value;
                data.limit = document.getElementById('searchLimit').value;
            }
            tg.sendData(JSON.stringify(data));
            tg.HapticFeedback.impactOccurred('medium');
            document.getElementById('parseResult').style.display = 'block';
            document.getElementById('parseList').innerHTML = '<p>‚è≥ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω...</p>';
        });

        document.getElementById('exportCsvBtn').addEventListener('click', () => {
            tg.sendData(JSON.stringify({ action: 'export_csv' }));
        });
        document.getElementById('exportExcelBtn').addEventListener('click', () => {
            tg.sendData(JSON.stringify({ action: 'export_excel' }));
        });

        // ---------- –ò–ù–í–ê–ô–¢–ò–ù–ì ----------
        const inviteSource = document.getElementById('inviteSource');
        const inviteFileDiv = document.getElementById('inviteFileInput');
        inviteSource.addEventListener('change', () => {
            inviteFileDiv.style.display = inviteSource.value === 'file' ? 'block' : 'none';
        });

        document.getElementById('chooseFileBtn').addEventListener('click', () => {
            document.getElementById('inviteFile').click();
        });
        document.getElementById('inviteFile').addEventListener('change', (e) => {
            document.getElementById('fileName').innerText = e.target.files[0]?.name || '';
        });

        const inviteDelay = document.getElementById('inviteDelay');
        const inviteDelayVal = document.getElementById('inviteDelayVal');
        inviteDelay.addEventListener('input', () => {
            inviteDelayVal.innerText = inviteDelay.value;
        });

        document.getElementById('startInviteBtn').addEventListener('click', () => {
            const data = {
                action: 'start_invite',
                chat: document.getElementById('inviteChat').value,
                source: inviteSource.value,
                delay: inviteDelay.value
            };
            tg.sendData(JSON.stringify(data));
            tg.HapticFeedback.impactOccurred('medium');
        });

        // ---------- –ü–†–û–ì–†–ï–í ----------
        const warmupDelay2 = document.getElementById('warmupDelay2');
        const warmupDelayVal2 = document.getElementById('warmupDelayVal2');
        warmupDelay2.addEventListener('input', () => {
            warmupDelayVal2.innerText = warmupDelay2.value;
        });

        document.getElementById('startWarmupBtn').addEventListener('click', () => {
            const data = {
                action: 'start_warmup',
                accounts: document.getElementById('warmupAccounts').value,
                delay: warmupDelay2.value,
                actions: {
                    view: document.getElementById('actionView').checked,
                    like: document.getElementById('actionLike').checked,
                    comment: document.getElementById('actionComment').checked,
                    join: document.getElementById('actionJoin').checked
                }
            };
            tg.sendData(JSON.stringify(data));
            tg.HapticFeedback.impactOccurred('medium');
        });

        // ---------- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –ü–†–û–§–ò–õ–¨ ----------
        document.getElementById('refreshStatsBtn').addEventListener('click', () => {
            tg.sendData(JSON.stringify({ action: 'get_stats' }));
        });
        document.getElementById('refreshProfileBtn').addEventListener('click', () => {
            tg.sendData(JSON.stringify({ action: 'get_profile' }));
        });

        // ---------- –û–ë–†–ê–ë–û–¢–ö–ê –û–¢–í–ï–¢–û–í –û–¢ –ë–û–¢–ê ----------
        window.handleBotData = function(data) {
            try {
                const response = JSON.parse(data);
                if (response.type === 'parsing_result') {
                    const resultBox = document.getElementById('parseResult');
                    resultBox.style.display = 'block';
                    document.getElementById('parseCount').innerText = response.count || 0;
                    const listDiv = document.getElementById('parseList');
                    if (response.data && response.data.length) {
                        let html = '';
                        response.data.slice(0, 20).forEach(item => {
                            if (item.username) {
                                html += `<div class="result-item">üë§ @${item.username} (${item.first_name})</div>`;
                            } else {
                                html += `<div class="result-item">üì¢ ${item.title}</div>`;
                            }
                        });
                        listDiv.innerHTML = html;
                    } else {
                        listDiv.innerHTML = '<p>‚ùå –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                    }
                } else if (response.type === 'stats') {
                    document.getElementById('statsContent').innerHTML = `
                        <p>üë• –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${response.total_users}</p>
                        <p>üíé –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫: ${response.active_subs}</p>
                        <p>üí∞ –ü–ª–∞—Ç–µ–∂–µ–π: ${response.total_payments}</p>
                        <p>‚≠ê –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–≤—ë–∑–¥: ${response.total_stars}</p>
                    `;
                } else if (response.type === 'profile') {
                    document.getElementById('profileContent').innerHTML = `
                        <p>üÜî ID: ${response.user_id}</p>
                        <p>üë§ –ò–º—è: ${response.first_name}</p>
                        <p>üíé –ü–æ–¥–ø–∏—Å–∫–∞: ${response.subscription}</p>
                        <p>‚ö° –ü–æ—Ç–æ–∫–∏: ${response.threads}</p>
                    `;
                }
            } catch (e) {
                console.log('–û—Ç–≤–µ—Ç –±–æ—Ç–∞:', data);
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateConstructorPrice();
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        tg.sendData(JSON.stringify({ action: 'get_stats' }));
        tg.sendData(JSON.stringify({ action: 'get_profile' }));
    </script>
</body>
</html>
